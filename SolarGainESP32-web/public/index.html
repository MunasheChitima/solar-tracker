<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SolarGain Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="topbar"></div>
    <header class="header">
      <div class="container">
        <h1>SolarGain Dashboard</h1>
        <p>Hourly irradiance forecast and daily total</p>
      </div>
    </header>

    <main class="container">
      <section class="controls">
        <div class="grid">
          <label style="grid-column: span 3; position: relative;" for="address">
            Address (start typing and choose)
            <input id="address" type="text" autocomplete="off" placeholder="e.g. 32 George Road, Hatfield, Harare" 
                   aria-describedby="address-help" aria-label="Enter your location address" />
            <div id="addrSuggest" class="suggestions" style="display:none;" role="listbox" aria-label="Address suggestions"></div>
            <small id="addrConfirm" class="muted"></small>
            <small id="address-help" class="help-text">Start typing your address and select from suggestions</small>
          </label>
          <input id="lat" type="hidden" value="-17.7831" />
          <input id="lon" type="hidden" value="31.0909" />
          <input id="elev" type="hidden" />
          <input id="tz" type="hidden" />
          <label for="tilt">
            Panel tilt (°) <span class="required">*</span>
            <input id="tilt" type="number" step="1" min="0" max="90" value="30" required 
                   aria-describedby="tilt-help" aria-label="Panel tilt angle in degrees" />
            <small id="tilt-help" class="help-text">Angle of your solar panels (0° = flat, 90° = vertical)</small>
          </label>
          <label for="panelWatt">
            Panel wattage (W) <span class="required">*</span>
            <input id="panelWatt" type="number" step="1" min="1" max="10000" value="400" required 
                   aria-describedby="panelWatt-help" aria-label="Panel wattage in watts" />
            <small id="panelWatt-help" class="help-text">Power rating of each solar panel</small>
          </label>
          <label for="panelCount">
            Panel count <span class="required">*</span>
            <input id="panelCount" type="number" step="1" min="1" max="1000" value="1" required 
                   aria-describedby="panelCount-help" aria-label="Number of solar panels" />
            <small id="panelCount-help" class="help-text">Total number of solar panels</small>
          </label>
          <label for="batteryAh">
            Battery capacity (Ah)
            <input id="batteryAh" type="number" step="0.1" min="1" max="10000" value="100" 
                   aria-describedby="batteryAh-help" aria-label="Battery capacity in amp-hours" />
            <small id="batteryAh-help" class="help-text">e.g., 100 Ah</small>
          </label>
          <label for="batteryV">
            Battery voltage (V)
            <input id="batteryV" type="number" step="0.1" min="1" max="1000" value="52.5" 
                   aria-describedby="batteryV-help" aria-label="Nominal battery voltage in volts" />
            <small id="batteryV-help" class="help-text">e.g., 52.5 V</small>
          </label>
          <div>
            <div class="muted" style="margin-bottom:6px;">Panel direction</div>
            <div id="azBtns" class="az-grid" role="radiogroup" aria-label="Panel direction selection">
              <button type="button" data-az="0" class="active" aria-label="North (0°)" title="North (0°)">N</button>
              <button type="button" data-az="45" aria-label="Northeast (45°)" title="Northeast (45°)">NE</button>
              <button type="button" data-az="90" aria-label="East (90°)" title="East (90°)">E</button>
              <button type="button" data-az="135" aria-label="Southeast (135°)" title="Southeast (135°)">SE</button>
              <button type="button" data-az="180" aria-label="South (180°)" title="South (180°)">S</button>
              <button type="button" data-az="225" aria-label="Southwest (225°)" title="Southwest (225°)">SW</button>
              <button type="button" data-az="270" aria-label="West (270°)" title="West (270°)">W</button>
              <button type="button" data-az="315" aria-label="Northwest (315°)" title="Northwest (315°)">NW</button>
            </div>
            <input id="az" type="hidden" value="0" />
            <small class="muted">Tip: In the southern hemisphere, point North (0°). In the northern hemisphere, point South (180°).</small>
          </div>
        </div>
        <div class="grid" style="grid-template-columns: repeat(6, 1fr); margin-top: 8px; align-items: end;">
          <label for="date">
            Date
            <input id="date" type="date" aria-label="Select date for solar calculations" />
          </label>
          <div style="display:flex; gap:8px; align-items: center;">
            <button id="runBtn" type="button" aria-label="Calculate solar irradiance">Compute</button>
            <button id="csvBtn" type="button" title="Download CSV" aria-label="Export data as CSV file">Export CSV</button>
            <button id="shareBtn" type="button" title="Copy link with current settings" aria-label="Share current settings">Share Link</button>
            <label class="muted" style="display:flex; align-items:center; gap:6px; margin:0;" for="tableToggle">
              <input id="tableToggle" type="checkbox" aria-label="Show hourly data table" /> Show hourly table
            </label>
          </div>
        </div>
      </section>

      <section class="summary">
        <div class="card">
          <h2 id="dateLabel">—</h2>
          <p class="muted" id="weatherSummary">—</p>
          <div class="kpi">
            <div>
              <div class="kpi-label">Daily Total</div>
              <div class="kpi-value" id="dailyTotal">0.00 kWh/m²</div>
            </div>
            <div>
              <div class="kpi-label">Your System Today</div>
              <div class="kpi-value" id="panelTotal">0.00 kWh</div>
            </div>
            <div>
              <div class="kpi-label">Battery Charge Today</div>
              <div class="kpi-value" id="batteryGainAh">0.0 Ah</div>
            </div>
            <div>
              <div class="kpi-label">Battery % of Capacity</div>
              <div class="kpi-value" id="batteryGainPct">0%</div>
            </div>
            <div>
              <div class="kpi-label">Current Temp</div>
              <div class="kpi-value" id="currentTemp">—</div>
            </div>
            <div>
              <div class="kpi-label">Precipitation</div>
              <div class="kpi-value" id="precipNow">—</div>
            </div>
            <div>
              <div class="kpi-label">Humidity</div>
              <div class="kpi-value" id="humidityNow">—</div>
            </div>
            <div>
              <div class="kpi-label">Wind</div>
              <div class="kpi-value" id="windNow">—</div>
            </div>
            <div>
              <div class="kpi-label">Sunrise</div>
              <div class="kpi-value" id="sunrise">—</div>
            </div>
            <div>
              <div class="kpi-label">Sunset</div>
              <div class="kpi-value" id="sunset">—</div>
            </div>
          </div>
        </div>
      </section>

      <section class="card" id="dailyOutlook">
        <h3>Next 7 Days</h3>
        <div id="outlookGrid" class="outlook-grid"></div>
        <div style="height:8px;"></div>
        <h4 class="muted" style="margin:6px 0 8px;">Solar forecast</h4>
        <div id="weeklyGrid" class="weekly-grid"></div>
      </section>

      <section class="chart card">
        <canvas id="irrChart" height="140"></canvas>
      </section>

      <section class="table card" id="hourlyTable" style="display:none;">
        <table>
          <thead>
            <tr><th>Hour</th><th>Irradiance (kWh/m²)</th><th>Temperature (°C)</th><th>Precip (%)</th><th>Wind (km/h)</th><th>Clouds</th></tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </section>

      <section class="card" id="equiv">
        <h3>What can this power?</h3>
        <p class="muted">Based on your daily kWh/m², here are simple examples.</p>
        <ul id="equivList"></ul>
      </section>

      


      <section class="card" id="tips">
        <h3>Installation Tips</h3>
        <ul>
          <li>Clean panels monthly for best performance</li>
          <li>Check for shading from trees or buildings</li>
          <li>Consider battery storage for night use</li>
          <li>Monitor actual vs predicted output</li>
        </ul>
      </section>
    </main>

    <footer class="footer">
      <div class="container">Made with ☀️ for Harare — SolarGain</div>
    </footer>

    <script type="module" src="./app.js"></script>
  </body>
  </html>


