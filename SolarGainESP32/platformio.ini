[env:esp32s3]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
upload_protocol = esptool
monitor_speed = 115200
upload_speed = 115200
monitor_port = /dev/cu.usbmodem214301
upload_port = /dev/cu.usbmodem214301
; Use default esptool reset behavior; flags removed for compatibility

; Ensure USB CDC is enabled at boot for auto-reset without buttons
build_flags = 
    -D USER_SETUP_LOADED=1
    -D ST7789_DRIVER=1
    -D TFT_WIDTH=172
    -D TFT_HEIGHT=320
    -D TFT_MISO=19
    -D TFT_MOSI=11
    -D TFT_SCLK=12
    -D TFT_CS=10
    -D TFT_DC=14
    -D TFT_RST=13
    -D TFT_BL=21
    -D LOAD_GLCD=1
    -D LOAD_FONT2=1
    -D LOAD_FONT4=1
    -D LOAD_FONT6=1
    -D LOAD_GFXFF=1
    -D SMOOTH_FONT=1
    -D SPI_FREQUENCY=40000000
    -D SPI_READ_FREQUENCY=20000000
    -D ARDUINO_USB_CDC_ON_BOOT=1

; Library dependencies
lib_deps = 
    ; Time and NTP
    NTPClient@^3.2.1
    Time@^1.6.1
    
    ; Display
    TFT_eSPI@^2.5.0
    
    ; JSON parsing
    ArduinoJson@^6.21.0
    
    ; HTTP/HTTPS
    HTTPClient
    
    ; OTA Updates (optional)
    ArduinoOTA
    
    ; Unit testing
    Unity@^2.5.2

; Build flags

; Test configuration
test_build_src = yes
test_framework = unity
